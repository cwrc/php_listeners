<?php
/**
 * Created by IntelliJ IDEA.
 * User: ppound
 * Date: 2014-07-09
 * Time: 9:03 AM
 */

require_once 'includes/transform_utilities.php';


class TransformsTest extends PHPUnit_Framework_TestCase {

  public function testEmlWithItis() {
    $test_data_location = '/tmp/testeml.xml';
    copy('test/testData/eml.xml', $test_data_location);
    $bytes = transform_service_eml_with_itis($test_data_location, $this->itisString);
    $this->assertGreaterThan(0, $bytes);
    $eml_doc = new DOMDocument();
    $eml_doc->load($test_data_location);
    $node_list = $eml_doc->getElementsByTagName('taxonicClassification');
    $this->assertGreaterThan(3,$node_list->length);
    unlink($test_data_location);
  }

  private $itisString = <<<ITIS
<ns:getFullHierarchyFromTSNResponse xmlns:ns="http://itis_service.itis.usgs.gov"><ns:return xmlns:ax21="http://data.itis_service.itis.usgs.gov/xsd" xmlns:ax26="http://itis_service.itis.usgs.gov/xsd" xmlns:ax23="http://metadata.itis_service.itis.usgs.gov/xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ax21:SvcHierarchyRecordList"><ax21:tsn>52183</ax21:tsn><ax21:author></ax21:author><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>202423</ax21:tsn><ax21:author xsi:nil="true"></ax21:author><ax21:parentName></ax21:parentName><ax21:parentTsn></ax21:parentTsn><ax21:rankName>Kingdom</ax21:rankName><ax21:taxonName>Animalia</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>914153</ax21:tsn><ax21:author xsi:nil="true"></ax21:author><ax21:parentName>Animalia</ax21:parentName><ax21:parentTsn>202423</ax21:parentTsn><ax21:rankName>Subkingdom</ax21:rankName><ax21:taxonName>Radiata</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>48738</ax21:tsn><ax21:author>Hatschek, 1888</ax21:author><ax21:parentName>Radiata</ax21:parentName><ax21:parentTsn>914153</ax21:parentTsn><ax21:rankName>Phylum</ax21:rankName><ax21:taxonName>Cnidaria</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>914163</ax21:tsn><ax21:author xsi:nil="true"></ax21:author><ax21:parentName>Cnidaria</ax21:parentName><ax21:parentTsn>48738</ax21:parentTsn><ax21:rankName>Subphylum</ax21:rankName><ax21:taxonName>Anthozoa</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>51938</ax21:tsn><ax21:author>Ehrenberg, 1834</ax21:author><ax21:parentName>Anthozoa</ax21:parentName><ax21:parentTsn>914163</ax21:parentTsn><ax21:rankName>Class</ax21:rankName><ax21:taxonName>Anthozoa</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52004</ax21:tsn><ax21:author>Haeckel, 1866</ax21:author><ax21:parentName>Anthozoa</ax21:parentName><ax21:parentTsn>51938</ax21:parentTsn><ax21:rankName>Subclass</ax21:rankName><ax21:taxonName>Octocorallia</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52016</ax21:tsn><ax21:author>Lamouroux, 1816</ax21:author><ax21:parentName>Octocorallia</ax21:parentName><ax21:parentTsn>52004</ax21:parentTsn><ax21:rankName>Order</ax21:rankName><ax21:taxonName>Alcyonacea</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52112</ax21:tsn><ax21:author>Studer, 1887</ax21:author><ax21:parentName>Alcyonacea</ax21:parentName><ax21:parentTsn>52016</ax21:parentTsn><ax21:rankName>Suborder</ax21:rankName><ax21:taxonName>Holaxonia</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52172</ax21:tsn><ax21:author>Gray, 1859</ax21:author><ax21:parentName>Holaxonia</ax21:parentName><ax21:parentTsn>52112</ax21:parentTsn><ax21:rankName>Family</ax21:rankName><ax21:taxonName>Plexauridae</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52183</ax21:tsn><ax21:author>Lamouroux, 1816</ax21:author><ax21:parentName>Plexauridae</ax21:parentName><ax21:parentTsn>52172</ax21:parentTsn><ax21:rankName>Genus</ax21:rankName><ax21:taxonName>Eunicea</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52197</ax21:tsn><ax21:author>Milne Edwards and Haime, 1857</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea asperula</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52184</ax21:tsn><ax21:author>(Ellis and Solander, 1786)</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea calyculata</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52190</ax21:tsn><ax21:author>Bayer, 1961</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea clavigera</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52187</ax21:tsn><ax21:author>Duchassaing and Michelotti, 1860</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea fusca</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52188</ax21:tsn><ax21:author>Bayer, 1961</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea knighti</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52189</ax21:tsn><ax21:author>Duchassaing and Michelotti, 1860</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea laciniata</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52191</ax21:tsn><ax21:author xsi:nil="true"></ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea laxispica</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52192</ax21:tsn><ax21:author>Lamouroux, 1816</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea mammosa</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52193</ax21:tsn><ax21:author>Bayer, 1961</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea palmeri</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52194</ax21:tsn><ax21:author xsi:nil="true"></ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea pinta</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52196</ax21:tsn><ax21:author>(Pallas, 1766)</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea succinea</ax21:taxonName></ax21:hierarchyList><ax21:hierarchyList xsi:type="ax21:SvcHierarchyRecord"><ax21:tsn>52195</ax21:tsn><ax21:author>Milne Edwards and Haime, 1857</ax21:author><ax21:parentName>Eunicea</ax21:parentName><ax21:parentTsn>52183</ax21:parentTsn><ax21:rankName>Species</ax21:rankName><ax21:taxonName>Eunicea tourneforti</ax21:taxonName></ax21:hierarchyList><ax21:rankName></ax21:rankName><ax21:sciName></ax21:sciName></ns:return></ns:getFullHierarchyFromTSNResponse>
ITIS;


}
 